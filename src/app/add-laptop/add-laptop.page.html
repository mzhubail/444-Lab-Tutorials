<ion-header [translucent]="true">
  <app-toolbar title="Add Laptop"></app-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large"> Add Laptop </ion-title>
    </ion-toolbar>
  </ion-header>


  <ion-segment [(ngModel)]="segment">
    <ion-segment-button value="new">
      <ion-label (click)="setSegment('new')"> NEW </ion-label>
    </ion-segment-button>
    <ion-segment-button value="list">
      <ion-label (click)="setSegment('list')"> LIST </ion-label>
    </ion-segment-button>
  </ion-segment>


  <form [ngSwitch]="segment" [formGroup]="laptopForm">
    <ion-list *ngSwitchCase="'new'">
      <ion-item>
        <ion-input label="Brand:" placeholder="Enter laptop brand"
            formControlName="brand"></ion-input>
      </ion-item>
      <ion-item>
        <ion-select interface="action-sheet" label="CPU:" placeholder="Select Processor"
            formControlName="cpu">
          <ion-select-option
              *ngFor="let cpu of CPU_OPTIONS"
              [value]="cpu">
            {{ capitalize(cpu) }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-select interface="action-sheet" label="GPU:" placeholder="Select Graphics"
            formControlName="gpu">
          <ion-select-option
              *ngFor="let gpu of GPU_OPTIONS"
              [value]="gpu">
            {{ capitalize(gpu) }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-range formControlName="ram" [label]="'Ram: ' + (laptopForm.controls.ram.value ?? '')"
            [pin]="true" [min]="0" [max]="16" value="0">
        </ion-range>
      </ion-item>
      <ion-item>
        <ion-range  formControlName="weight" [label]="'Weight: ' + (laptopForm.controls.weight.value ?? '')"
            [pin]="true" [min]="0" [max]="3" step="0.5" value="0">
        </ion-range>
      </ion-item>
      <ion-item style="display: flex; flex-direction: row; justify-content: space-between;">
        <!-- <ion-label> Screen size: </ion-label> -->
        <div class="container"> Screen size: </div>
        <ion-radio-group style="width: 50%;" [value]="SCREEN_OPTIONS[0]" formControlName="screen">
          <ion-radio *ngFor="let scr of SCREEN_OPTIONS" [value]="scr"
              justify="end">
            {{ scr }} inches
          </ion-radio> <br />
        </ion-radio-group>
      </ion-item>

      <ion-item>
        <ion-toggle formControlName="storage"> HDD: </ion-toggle>
      </ion-item>
      <ion-item>
        <ion-toggle formControlName="os"> OS: </ion-toggle>
      </ion-item>

      <ion-item>
        <ion-label> Manfacturing date: </ion-label>

        <ion-button id="datetime-picker" color="medium">
          <!-- TODO: Fix this -->
          {{ mDate != initialDate ? formatISODate(mDate) : "Choose Date" }}
        </ion-button>

        <ion-modal #modal trigger="datetime-picker" [keepContentsMounted]="true">
          <ng-template>
            <ion-header>
              <ion-toolbar>
                <ion-title> Manufacturing date </ion-title>
                <ion-buttons slot="end">
                  <ion-button (click)="modal.dismiss()"> Continue </ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-header>
            <ion-content>
              <ion-datetime style="margin: 0 auto; margin-top: 2rem;"
                  formControlName="manuDate" presentation="date"
                  [max]="initialDate">
              </ion-datetime>
            </ion-content>
          </ng-template>
        </ion-modal>
      </ion-item>

      <ion-item>
        <ion-button color="primary" size="default" (click)="addLaptop()" [disabled]="laptopForm.invalid">
          Add
        </ion-button>
        <ion-button color="danger" size="small" (click)="laptopForm.reset()">
        <!-- <ion-button color="danger" size="small" (click)="laptopForm.patchValue(laptopsService.emptyLaptop())"> -->
          Reset
        </ion-button>
      </ion-item>

      <div class="container">
        <ul class="list-group">
          <li class="list-group-item" *ngFor="let ctrl of laptopForm.controls | keyvalue">
            <!-- {{ laptopForm.controls.brand.value }} -->
            {{ ctrl.key }}: {{ ctrl.value.value }}
          </li>
          <button type="button" class="list-group-item list-group-item-action" (click)="logForm()">
            {{ laptopForm.status }}
          </button>
        </ul>
      </div>

    </ion-list>


    <div *ngSwitchCase="'list'">
      <ion-accordion-group #accordionGroup *ngIf="this.laptopsService.laptops.length != 0">
        <ion-accordion
            *ngFor="let laptop of laptopsService.laptops let i = index;"
            [value]="i">

          <!-- Using sliding item makes the accordion icon disappear -->
          <!-- <ion-item-sliding slot="header">
            <ion-item color="light">
              <ion-label> {{ laptop.brand }} </ion-label>
            </ion-item>
            <ion-item-options>
              <ion-item-option color="danger"> Delete </ion-item-option>
            </ion-item-options>
          </ion-item-sliding> -->

          <ion-item slot="header" color="light">
            <ion-label> {{ laptop.brand }} </ion-label>
          </ion-item>

          <div class="ion-padding" slot="content"
              *ngFor="let x of accordion_helper(laptop) | keyvalue">
              {{ x.key }}: {{ x.value }}
          </div>

          <div style="padding-right: 1rem; padding-bottom: 1rem; text-align: end;" slot="content">
            <!-- Accordion null is here so that the when an element is deleted the accordion is left with no element open -->
            <ion-button color="danger" (click)="accordionGroup.value = null; laptopsService.removeLaptop(i)"
                size="small">
              Delete
            </ion-button>
          </div>
        </ion-accordion>
      </ion-accordion-group>
      <div class="ion-padding" *ngIf="this.laptopsService.laptops.length == 0">
        No Laptops are stored
      </div>
    </div>
  </form>
</ion-content>
